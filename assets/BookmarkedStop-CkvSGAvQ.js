import{u as S,e as h,r as s,C as g,D as f,j as a,b as T,A as j}from"./index-CJMgYQ0G.js";import{N as k,B as v,D as w}from"./NoticeCard-ClgIYXTI.js";import{e as m,T as R,a as y,P as L,d as M}from"./App-CN_8WmNx.js";import{S as B}from"./index-BKlxdzKy.js";import{S as I}from"./StopRouteList-ZfDMU5kE.js";import"./CircularProgress-pLTm8SYB.js";const $=({stopTab:u,onChangeTab:r})=>{const{t:l}=S(),p=h(),{savedStops:i}=s.useContext(g),{db:{stopList:c}}=s.useContext(f);return i.length===0?a.jsxs(a.Fragment,{children:[a.jsx(m,{variant:"h6",children:l("未有收藏車站")}),a.jsx(m,{variant:"body1",children:l("請按下圖指示增加")})]}):a.jsx(R,{value:u,onChange:(t,n)=>r(n,!0),sx:D,variant:"scrollable",scrollButtons:!0,children:i.map(t=>t.split("|")).filter(([,t])=>c[t]).map(([t,n])=>a.jsx(y,{label:c[n].name[p],value:`${t}|${n}`,disableRipple:!0},`stops-${n}`))})},D={background:u=>u.palette.background.default,minHeight:"36px","& .MuiTab-root":{alignItems:"center",justifyContent:"center",paddingTop:0,paddingBottom:0,minHeight:"32px"},"& .MuiTabs-flexContainer":{justifyContent:"flex-start"}},E=T.forwardRef(({stopTab:u,onChangeTab:r},l)=>{const{savedStops:p}=s.useContext(g),{db:{stopList:i,stopMap:c}}=s.useContext(f),t=s.useRef(u);s.useImperativeHandle(l,()=>({changeTab:e=>{t.current=e}}));const n=s.useMemo(()=>p.filter(e=>e.split("|")[1]in i),[p,i]),d=s.useCallback(()=>{let e=n.indexOf(t.current);return e!==-1?e:-1},[n]),b=s.useMemo(()=>n.map(e=>{var x;if(e==="")return[];const o=[e.split("|")];return(x=c[o[0][1]])==null||x.forEach(C=>o.push(C)),o}),[n,c]);return a.jsx(B,{index:d(),onChangeIndex:e=>{r(n[e])},children:b.map((e,o)=>a.jsx(I,{stops:e,isFocus:d()===o},`savedStops-${o}`))})}),z=()=>{const{colorMode:u}=s.useContext(j),{savedStops:r}=s.useContext(g),{db:{stopList:l}}=s.useContext(f),p=h(),i=s.useRef(null),c=s.useMemo(()=>{try{const e=localStorage.getItem("stopTab")??"|";if(e&&r.includes(e)&&l[e.split("|")[1]])return e;for(let o=0;o<r.length;++o){let x=r[o].split("|")[1];if(l[x])return r[o]}}catch(e){console.error(e)}return""},[r,l]),[t,n]=s.useState(c),d=s.useCallback(e=>t===""?"unset":e.palette.mode==="dark"?e.palette.background.default:"white",[t]);s.useEffect(()=>{localStorage.setItem("stopTab",t)},[t]);const b=s.useCallback(e=>{var o;n(e),(o=i.current)==null||o.changeTab(e)},[]);return a.jsxs(L,{sx:{...A,bgcolor:d,backgroundImage:t===""?`url(/img/stop-bookmark-guide-${u}-${p}.png)`:"unset",opacity:t===""?"0.8":"unset"},square:!0,elevation:0,children:[a.jsx($,{stopTab:t,onChangeTab:b}),a.jsx(k,{}),a.jsx(v,{}),a.jsx(w,{}),a.jsx(M,{sx:{flex:1,overflow:"scroll"},children:a.jsx(E,{ref:i,stopTab:t,onChangeTab:b})})]})},A={textAlign:"center",display:"flex",flexDirection:"column",overflow:"auto",width:"100%",flex:1,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"};export{z as default};
