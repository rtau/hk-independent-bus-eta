function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/SharingModal-DbLjZYNX.js","assets/index-CJMgYQ0G.js","assets/index-BSkLjl09.css","assets/TimeReport-CarbNXdO.js","assets/App-CN_8WmNx.js","assets/App-C05wK8aK.css","assets/CircularProgress-pLTm8SYB.js","assets/Snackbar-Ngimpp10.js","assets/RouteMap-DhzS6FxC.js","assets/BaseTile-Zy4_3G0U.js","assets/CompassControl-CgGBunbt.js","assets/index-DJ_Y8GTM.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{j as e,u as T,e as N,r as l,D as L,A as oe,B as re,F as ee,q as H,v as pe,C as Q,t as A,b as X,h as te,_ as ae,g as he,z as xe,G as ge}from"./index-CJMgYQ0G.js";import{c as _,h as le,f as W,i as Z,d as M,j as me,k as be,l as se,e as z,L as je,m as Ce,I as B,P as ve,R as Se,D as ke,B as ye,n as $e,b as we,u as De}from"./App-CN_8WmNx.js";import{S as ie}from"./Star-DSWcH6WU.js";import{A as Me,a as Ie,b as Re,T as ze}from"./TimeReport-CarbNXdO.js";import{I as Be,S as Oe}from"./Share-YDrHN7ar.js";import{S as Te}from"./StopRouteList-ZfDMU5kE.js";import{D as Le}from"./DialogTitle-CByMK8l8.js";import{C as Ae}from"./Close-Ux6OdmKC.js";import"./CircularProgress-pLTm8SYB.js";const _e=_(e.jsx("path",{d:"m12 7.27 4.28 10.43-3.47-1.53-.81-.36-.81.36-3.47 1.53zM12 2 4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"}),"NavigationOutlined"),Ee=_(e.jsx("path",{d:"M10 20h4c0 1.1-.9 2-2 2s-2-.9-2-2m4-11c0 2.61 1.67 4.83 4 5.66V17h2v2H4v-2h2v-7c0-2.79 1.91-5.14 4.5-5.8v-.7c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5v.7c.71.18 1.36.49 1.95.9C14.54 6.14 14 7.51 14 9m10-1h-3V5h-2v3h-3v2h3v3h2v-3h3z"}),"NotificationAdd"),Pe=_(e.jsx("path",{d:"M20 18.69 7.84 6.14 5.27 3.49 4 4.76l2.8 2.8v.01c-.52.99-.8 2.16-.8 3.42v5l-2 2v1h13.73l2 2L21 19.72zM12 22c1.11 0 2-.89 2-2h-4c0 1.11.89 2 2 2m6-7.32V11c0-3.08-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68c-.15.03-.29.08-.42.12-.1.03-.2.07-.3.11h-.01c-.01 0-.01 0-.02.01-.23.09-.46.2-.68.31 0 0-.01 0-.01.01z"}),"NotificationsOff"),Fe=_([e.jsx("path",{d:"M12 4c1.93 0 5 1.4 5 5.15 0 2.16-1.72 4.67-5 7.32-3.28-2.65-5-5.17-5-7.32C7 5.4 10.07 4 12 4m0-2C8.73 2 5 4.46 5 9.15c0 3.12 2.33 6.41 7 9.85 4.67-3.44 7-6.73 7-9.85C19 4.46 15.27 2 12 2"},"0"),e.jsx("path",{d:"M12 7c-1.1 0-2 .9-2 2s.9 2 2 2a2 2 0 1 0 0-4M5 20h14v2H5z"},"1")],"PinDropOutlined"),He=_(e.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorder"),Ne=_(e.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"}),"StarBorderOutlined"),Ue=_(e.jsx("path",{d:"m18 12 4-4-4-4v3H3v2h15zM6 12l-4 4 4 4v-3h15v-2H6z"}),"SyncAlt"),qe=({routeId:t,stopId:s})=>{const{t:n}=T(),o=N(),{db:{routeList:r,holidays:a,stopList:i,serviceDayMap:x}}=l.useContext(L),{vibrateDuration:v}=l.useContext(oe),{route:c,stops:u,co:p,gtfsId:m}=r[t],h=le(),b=l.useMemo(()=>re(a,new Date),[a]),R=l.useMemo(()=>{const w=Object.entries(r).reduce((f,[$,D])=>{if($===t)return f;const{co:g,route:k,gtfsId:P}=D;return p[0]==="gmb"&&m&&m!==P?f:k===c&&JSON.stringify(p)===JSON.stringify(g)?[...f,[$,D]]:f},[]).sort(([,f],[,$])=>{const D=ee(f.route,f.freq,b,x),g=ee($.route,$.freq,b,x);if(D===g){const k=i[Object.values(u)[0][0]],P=i[Object.values(u)[0].slice(-1)[0]],G=i[Object.values(f.stops)[0][0]],J=i[Object.values(f.stops)[0].slice(-1)[0]],K=H(G.location,P.location)+H(k.location,J.location),d=i[Object.values($.stops)[0][0]],j=i[Object.values($.stops)[0].slice(-1)[0]],S=H(d.location,P.location)+H(k.location,j.location);return K<S?-1:1}return D>g?-1:1}).map(([f])=>f).filter(f=>f.toLowerCase()!==t);if(w.length===0)return null;const y=i[s].location;let I=Object.values(r[w[0]].stops)[0],C=-1,E=9999999;for(let f=0;f<I.length;++f){let $=H(y,i[I[f]].location);$<E&&(E=$,C=f)}return`/${o}/route/${w[0].toLowerCase()}/${I[C]}%2C${C}`},[c,p,m,r,i,b,t,u,x,o,s]),O=l.useCallback(w=>y=>{y.preventDefault(),w&&(pe(v),h(w))},[h,v]);return R&&e.jsxs(e.Fragment,{children:[e.jsx(W,{orientation:"vertical",sx:Ve}),e.jsx(Z,{variant:"text","aria-label":"open-timetable",sx:We,size:"small",startIcon:e.jsx(Ue,{}),onClick:O(R),children:n("對頭線")})]})},Ve={position:"absolute",top:"0",left:"calc(64px + 2%)"},We={color:t=>t.palette.getContrastText(t.palette.background.default),position:"absolute",top:0,left:"2%",flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},Ge=({routeId:t})=>{const{db:{routeList:s}}=l.useContext(L),{t:n}=T(),o=N(),{route:r,co:a,gtfsId:i}=s[t],x=l.useMemo(()=>a.map(c=>{switch(c){case"ctb":return[c,`https://mobile.citybus.com.hk/nwp3/?f=1&ds=${r}&dsmode=1&l=${o==="zh"?0:1}`];case"kmb":return[c,`https://search.kmb.hk/KMBWebSite/?action=routesearch&route=${r}&lang=${o==="zh"?"zh-hk":"en"}`];case"gmb":return[c,`https://h2-app-rr.hkemobility.gov.hk/ris_page/get_gmb_detail.php?lang=${o==="zh"?"TC":"EN"}&route_id=${i}`];case"nlb":return[c,`https://www.nlb.com.hk/route?q=${r}`];case"lrtfeeder":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/searchBusRouteDetails.php?routeID=${r}`];case"lightRail":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/schedule_index.html`];case"mtr":return[c,`https://www.mtr.com.hk/${o==="zh"?"ch":"en"}/customer/services/train_service_index.html`];default:return[c,""]}}),[a,r,o,i]),v=l.useCallback(c=>()=>{c&&window.open(c,"_blank")},[]);return e.jsx(M,{sx:Je,children:x.map(([c,u])=>e.jsx(Z,{onClick:v(u),variant:"outlined",size:"small",endIcon:e.jsx(me,{}),children:n(c)},c))})},Je={display:"flex",gap:1},Ke=({routeId:t,open:s,onClose:n})=>{const{t:o}=T(),{db:{routeList:r,holidays:a}}=l.useContext(L),{freq:i,jt:x}=r[t],v=l.useMemo(()=>re(a,new Date),[a]),c=l.useMemo(()=>({onClose:()=>{n()}}),[n]),u=l.useMemo(()=>({sx:Qe}),[]);return e.jsxs(be,{open:s,ModalProps:c,PaperProps:u,anchor:"right",children:[x&&e.jsxs(e.Fragment,{children:[e.jsx(se,{sx:ne,children:e.jsxs(M,{sx:Xe,children:[e.jsx(z,{variant:"subtitle1",children:o("車程")}),e.jsxs(z,{variant:"subtitle1",children:[Math.round(parseFloat(x)),o("分鐘")]})]})}),e.jsx(W,{sx:{width:"80%"}})]}),e.jsx(je,{sx:{flex:1,overflow:"auto"},children:i&&Object.entries(i).map(([p,m])=>e.jsxs(se,{sx:ne,children:[e.jsx(z,{variant:"subtitle1",children:o(Ye[p])}),Object.entries(m).sort((h,b)=>h[0]<b[0]?-1:1).map(([h,b])=>e.jsxs(M,{sx:st(h,b,p,v)?et:Ze,children:[e.jsxs(z,{variant:"body1",children:[h," ",b?`- ${b[0]}`:""]}),b?e.jsxs(z,{variant:"body1",children:[parseInt(b[1],10)/60,o("分鐘")]}):e.jsx(e.Fragment,{})]},`${p}-${h}`))]},p))}),e.jsx(W,{sx:{width:"80%",my:2}}),e.jsx(Ge,{routeId:t})]})},Ye={31:"星期一至五",287:"星期一至五",415:"星期一至五",63:"星期一至六",319:"星期一至六",447:"星期一至六",416:"星期六至日",480:"星期六至日",266:"星期二至四",271:"星期一至四",272:"星期五",288:"星期六",320:"星期日及公眾假期",448:"星期日及公眾假期",511:"所有日子",111:"除星期三外",1:"星期一",2:"星期二",4:"星期三",8:"星期四",16:"星期五",32:"星期六",64:"星期日",257:"星期一",258:"星期二",260:"星期三",264:"星期四",999:"未知日子"},Y={31:[!1,!0,!0,!0,!0,!0,!1],287:[!1,!0,!0,!0,!0,!0,!1],415:[!1,!0,!0,!0,!0,!0,!1],63:[!1,!0,!0,!0,!0,!0,!0],319:[!1,!0,!0,!0,!0,!0,!0],447:[!1,!0,!0,!0,!0,!0,!0],416:[!0,!1,!1,!1,!1,!1,!0],480:[!0,!1,!1,!1,!1,!1,!0],266:[!1,!1,!0,!0,!0,!1,!1],271:[!1,!0,!0,!0,!0,!1,!1],272:[!1,!1,!1,!1,!1,!0,!1],288:[!1,!1,!1,!1,!1,!1,!0],320:[!0,!1,!1,!1,!1,!1,!1],448:[!0,!1,!1,!1,!1,!1,!1],511:[!0,!0,!0,!0,!0,!0,!0],111:[!0,!0,!0,!1,!0,!0,!0],1:[!1,!0,!1,!1,!1,!1,!1],2:[!1,!1,!0,!1,!1,!1,!1],4:[!1,!1,!1,!0,!1,!1,!1],8:[!1,!1,!1,!1,!0,!1,!1],16:[!1,!1,!1,!1,!1,!0,!1],32:[!1,!1,!1,!1,!1,!1,!0],64:[!0,!1,!1,!1,!1,!1,!1],257:[!1,!0,!1,!1,!1,!1,!1],258:[!1,!1,!0,!1,!1,!1,!1],260:[!1,!1,!1,!0,!1,!1,!1],264:[!1,!1,!1,!1,!0,!1,!1],999:[!1,!1,!1,!1,!1,!1,!1]},Qe={height:"100vh",width:"80%",maxWidth:"320px",paddingTop:"56px",paddingLeft:"20px",backgroundColor:t=>t.palette.background.default,backgroundImage:"none",overflow:"hidden"},ne={flexDirection:"column",alignItems:"flex-start"},Xe={display:"flex",justifyContent:"space-between",width:"80%"},Ze={display:"flex",justifyContent:"space-between",width:"80%"},et={display:"flex",justifyContent:"space-between",width:"80%",color:t=>t.palette.primary.main,borderBottom:"1px solid"},tt=(t,s)=>{const n=new Date().getDay();return!!(Y[t]&&(Y[t][n]||Y[t][0]&&s))},st=(t,s,n,o)=>{if(!tt(n,o))return!1;const r=new Date,a=`${r.getHours()}${r.getMinutes()}`;return s?t<=a&&a<=s[0]:!1},nt=({routeId:t})=>{const[s,n]=l.useState(!1),{t:o}=T();return e.jsxs(e.Fragment,{children:[e.jsx(W,{orientation:"vertical",sx:ot}),e.jsx(Z,{variant:"text","aria-label":"open-timetable",sx:rt,size:"small",startIcon:e.jsx(Ce,{}),onClick:()=>n(!0),children:o("時間表")}),e.jsx(Ke,{routeId:t,open:s,onClose:()=>n(!1)})]})},ot={position:"absolute",top:"0",right:"calc(64px + 2%)"},rt={color:t=>t.palette.getContrastText(t.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},at=({routeId:t})=>{const{savedEtas:s,setCollectionDrawerRoute:n}=l.useContext(Q);return e.jsx(B,{sx:lt,size:"small",onClick:()=>{const o=`${t.toUpperCase()}`;n(o)},children:s.includes(t)?e.jsx(ie,{}):e.jsx(Ne,{})})},lt={color:t=>t.palette.getContrastText(t.palette.background.default),flexDirection:"column",justifyContent:"center","& > .MuiButton-label":{flexDirection:"column",justifyContent:"center"},"& > .MuiButton-startIcon":{margin:0}},it=({routeId:t,stopId:s})=>{const{t:n}=T(),o=N(),{db:{routeList:r}}=l.useContext(L),{route:a,orig:i,dest:x,nlbId:v}=r[t];return e.jsxs(ve,{id:"route-eta-header",sx:ct,elevation:0,children:[e.jsx(Se,{routeNo:n(a),component:"h1",align:"center"}),e.jsxs(z,{component:"h2",variant:"caption",align:"center",children:[n("往")," ",A(x[o])," ",v?n("由")+" "+A(i[o]):""]}),e.jsx(qe,{routeId:t,stopId:s}),e.jsxs(M,{sx:ut,children:[e.jsx(at,{routeId:t}),e.jsx(nt,{routeId:t})]})]})},ct={textAlign:"center",background:"transparent",position:"relative"},ut={position:"absolute",top:0,right:"2%"},ft=X.forwardRef((t,s)=>{const{routeId:n,stopId:o,stopIdx:r,idx:a,onShareClick:i,onSummaryClick:x,onStopInfoClick:v}=t,{db:{routeList:c,stopList:u}}=l.useContext(L),{savedEtas:p,setCollectionDrawerRoute:m,collections:h}=l.useContext(Q),{alarmStopId:b,toggleStopAlarm:R}=l.useContext(te),{isStopAlarm:O}=l.useContext(te),{t:w}=T(),y=N(),{fares:I,faresHoliday:C}=c[n],E=u[o],f=l.useMemo(()=>p.includes(`${n.toUpperCase()}/${a}`)||h.reduce((g,k)=>g||k.list.includes(`${n.toUpperCase()}/${a}`),!1),[p,h,n,a]),$=l.useCallback(g=>{i({routeId:n,seq:a,stopId:o,event:g})},[i,n,a,o]),D=l.useCallback((g,k)=>{x(a,k)},[a,x]);return e.jsxs(Me,{id:`stop-${a}`,expanded:r===a&&navigator.userAgent!=="prerendering",onChange:D,TransitionProps:{unmountOnExit:!0},ref:s,sx:dt,children:[e.jsxs(Ie,{sx:pt,children:[e.jsxs(z,{component:"h3",variant:"body1",sx:{fontWeight:700},children:[a+1,". ",A(E.name[y])]}),e.jsxs(z,{variant:"body2",children:[I&&I[a]?w("車費")+": $"+I[a]:"",C&&C[a]?"　　　　"+w("假日車費")+": $"+C[a]:""]})]}),e.jsxs(Re,{sx:ht,children:[e.jsx(ze,{containerSx:xt,routeId:`${n.toUpperCase()}`,seq:a}),e.jsxs(M,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[e.jsxs(M,{children:[O&&e.jsx(B,{"aria-label":"alert",onClick:()=>R(o),style:{backgroundColor:"transparent"},size:"large",children:b===o?e.jsx(Pe,{}):e.jsx(Ee,{})}),e.jsx(B,{"aria-label":"stop-info",onClick:v,style:{background:"transparent"},size:"large",children:e.jsx(Be,{})})]}),e.jsxs(M,{children:[e.jsx(B,{"aria-label":"share",onClick:$,style:{backgroundColor:"transparent"},size:"large",children:e.jsx(Oe,{})}),e.jsx(B,{"aria-label":"favourite",onClick:()=>{const g=`${n.toUpperCase()}/${a}`;m(g)},style:{backgroundColor:"transparent"},size:"large",children:f?e.jsx(ie,{sx:gt}):e.jsx(He,{})})]})]})]})]})}),dt={border:"1px solid rgba(0, 0, 0, .125)",boxShadow:"none","&:not(:last-child)":{borderBottom:0},"&:before":{display:"none"},"&.Mui-expanded":{margin:"auto"}},pt={backgroundColor:t=>t.palette.mode==="dark"?t.palette.background.default:"rgba(0, 0, 0, .03)","&.Mui-expanded":{borderBottom:"1px solid rgba(0, 0, 0, .125)",minHeight:44},minHeight:44,"& .MuiAccordionSummary-content":{margin:"8px 0",flexDirection:"column","&.Mui-expanded":{margin:"8px 0"}}},ht={display:"flex",alignItems:"center",pl:2,pr:1,py:1,justifyContent:"space-between"},xt={flex:1},gt={color:t=>t.palette.mode==="dark"?t.palette.primary.main:"inherit"},mt=X.lazy(()=>ae(()=>import("./SharingModal-DbLjZYNX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]))),bt=({routeId:t,stopIdx:s,stopIds:n,handleChange:o,onStopInfo:r})=>{const[a,i]=l.useState(null),x=l.useRef([]);l.useEffect(()=>{if(x.current[s]){const c=setTimeout(()=>{var u;(u=x.current[s])==null||u.scrollIntoView({behavior:"smooth",block:"center"})},50);return()=>{clearTimeout(c)}}},[s]);const v=l.useCallback(c=>u=>{x.current[c]=u},[]);return e.jsxs(M,{sx:jt,children:[n.map((c,u)=>e.jsx(ft,{routeId:t,stopId:c,stopIdx:s,idx:u,onShareClick:p=>i(p),onSummaryClick:o,onStopInfoClick:r,ref:v(u)},"stop-"+u)),a&&e.jsx(l.Suspense,{fallback:e.jsx(e.Fragment,{}),children:e.jsx(mt,{...a})})]})},jt={overflowY:"scroll"},Ct=({open:t,stops:s,onClose:n})=>{var u;const{db:{stopList:o}}=l.useContext(L),{savedStops:r,updateSavedStops:a}=l.useContext(Q),i=N(),x=l.useMemo(()=>s.reduce((p,m)=>p||r.includes(m.join("|")),!1),[s,r]),v=l.useCallback(()=>{var p;if((p=o[s[0][1]])!=null&&p.location){const{lat:m,lng:h}=o[s[0][1]].location;window.open(`https://www.google.com/maps/dir/?api=1&destination=${m},${h}&travelmode=walking`,"_blank")}},[o,s]),c=l.useCallback(()=>{var p;if((p=o[s[0][1]])!=null&&p.location){const{lat:m,lng:h}=o[s[0][1]].location;window.open(`https://www.google.com/maps/?q=${m},${h}`,"_blank")}},[o,s]);return e.jsxs(ke,{open:t,onClose:n,sx:vt,children:[e.jsxs(Le,{sx:St,children:[e.jsxs(M,{children:[e.jsx(B,{onClick:()=>a(s[0].join("|")),children:x?e.jsx(ye,{}):e.jsx($e,{})}),(u=o[s[0][1]])==null?void 0:u.name[i],"  ",e.jsx(B,{onClick:v,children:e.jsx(_e,{})}),e.jsx(B,{onClick:c,children:e.jsx(Fe,{})})]}),e.jsx(M,{children:e.jsx(B,{onClick:n,children:e.jsx(Ae,{})})})]}),e.jsx(we,{children:e.jsx(Te,{stops:s,isFocus:!0})})]})},vt={"& .MuiPaper-root":{width:"100%",marginTop:"90px",height:"calc(100vh - 100px)"},"& .MuiDialogContent-root":{padding:0}},St={backgroundColor:t=>t.palette.background.default,color:t=>t.palette.primary.main,display:"flex",justifyContent:"space-between"};var kt={compareTwoStrings:ce,findBestMatch:yt};function ce(t,s){if(t=t.replace(/\s+/g,""),s=s.replace(/\s+/g,""),t===s)return 1;if(t.length<2||s.length<2)return 0;let n=new Map;for(let r=0;r<t.length-1;r++){const a=t.substring(r,r+2),i=n.has(a)?n.get(a)+1:1;n.set(a,i)}let o=0;for(let r=0;r<s.length-1;r++){const a=s.substring(r,r+2),i=n.has(a)?n.get(a):0;i>0&&(n.set(a,i-1),o++)}return 2*o/(t.length+s.length-2)}function yt(t,s){if(!$t(t,s))throw new Error("Bad arguments: First argument should be a string, second should be an array of strings");const n=[];let o=0;for(let a=0;a<s.length;a++){const i=s[a],x=ce(t,i);n.push({target:i,rating:x}),x>n[o].rating&&(o=a)}const r=n[o];return{ratings:n,bestMatch:r,bestMatchIndex:o}}function $t(t,s){return!(typeof t!="string"||!Array.isArray(s)||!s.length||s.find(function(n){return typeof n!="string"}))}const wt=he(kt),Dt=({route:t})=>{const[s,n]=l.useState(!1),{db:{updateTime:o},renewDb:r}=l.useContext(L),{t:a}=T();return l.useEffect(()=>{fetch(`https://data.hkbus.app/route-ts/${`${t.route}+${t.serviceType}+${t.orig.en}+${t.dest.en}`.toUpperCase()}`).then(i=>{if(i.ok)return i.text();throw Error("no update")}).then(i=>{n(parseInt(i,10)*1e3>o)}).catch(i=>{console.log(i.message)})},[t,o]),s?e.jsx(M,{sx:Mt,onClick:r,children:e.jsx(z,{children:a("db-renew-text")})}):null},Mt={display:"flex",justifyContent:"center",flex:1,width:"100%",p:2,my:1,borderStyle:"solid",borderWidth:1,borderRadius:t=>t.shape.borderRadius/2,cursor:"pointer"},It=X.lazy(()=>ae(()=>import("./RouteMap-DhzS6FxC.js"),__vite__mapDeps([8,1,2,9,4,5,10,11]))),Nt=()=>{const{id:t,panel:s}=De(),{AppTitle:n,db:{routeList:o,stopList:r,stopMap:a}}=l.useContext(L),{updateSelectedRoute:i,energyMode:x,geoPermission:v,geolocation:c}=l.useContext(oe),u=Rt(t.toUpperCase(),o),p=o[u],{route:m,stops:h,co:b,orig:R,dest:O,fares:w}=p,y=l.useMemo(()=>zt(b,h).map(d=>[d,r[d]]).filter(([,d])=>d!=null).map(([d])=>d),[b,r,h]),I=l.useMemo(()=>{if(v==="granted"){const d=y.map((j,S)=>[S,H(c.current,r[j].location)]).sort((j,S)=>j[1]-S[1])[0];if(d.length>0)return d[0]}return 0},[v,c,r,y]),C=l.useMemo(()=>{if(s!==void 0){const[d,j]=s.split(",");if(d===void 0||j===void 0)return parseInt(s,10);{const S=parseInt(j,10);let U=0,q=9999999;for(let ue in h){let fe=h[ue].reduce((F,V,de)=>(V===d&&F.push(de),F),[]);for(let F of fe)if(F>=0){let V=Math.abs(F-S);V<q&&(U=F,q=V)}}return U}}return I},[s,h,I]),[E,f]=l.useState(!1),$=l.useMemo(()=>Bt(b,h,a,C),[b,C,a,h]),{t:D}=T(),g=N(),k=le(),P=l.useCallback((d,j)=>{if(j&&C!==d){let S=h[Object.keys(h).sort()[0]][d];k(`/${g}/route/${t}/${S}%2C${d}`,{replace:!0})}C===d&&!j&&f(!0)},[k,g,t,C,h]),G=l.useCallback(d=>{C===d&&f(!0),k(`/${g}/route/${t}/${d}`,{replace:!0})},[k,g,t,C]),J=l.useCallback(()=>{f(!0)},[f]),K=l.useCallback(()=>{f(!1)},[f]);return l.useEffect(()=>{var d;return f(!1),(d=document.getElementById("render"))==null||d.setAttribute("value","done"),i(t),()=>{var j;(j=document.getElementById("render"))==null||j.setAttribute("value","")}},[t,i]),l.useEffect(()=>{t.toUpperCase()!==u.toUpperCase()&&k(`/${g}/route/${u.toLowerCase()}`)},[t,u,g,k]),l.useEffect(()=>{const d=()=>{const j=w?w.filter((S,U,q)=>q.indexOf(S)===U).map(S=>`$${S}`):[];return g==="zh"?`路線${m}由${R.zh}出發，以${O.zh}為終點，`+(j.length?`分段車費為${j.join("、")}，`:"")+`途經${y.map(S=>r[S].name.zh).join("、")}。`:`Route ${m} is from ${A(R.en)} to ${A(O.en)}`+(j.length?`, section fees are ${j.join(", ")}. `:". ")+"Stops: "+A(y.map(S=>r[S].name.en).join(", "))+". "};xe({title:m+" "+D("往")+" "+A(O[g])+" - "+D(n),description:d(),lang:g}),ge({route:p,stopList:r,t:D,lang:g})},[n,O,w,g,R.en,R.zh,m,r,y,D,p]),e.jsxs(e.Fragment,{children:[e.jsx("input",{hidden:!0,id:"render"}),e.jsx(it,{routeId:u,stopId:y[C]}),e.jsx(Dt,{route:p}),!x&&navigator.userAgent!=="prerendering"&&e.jsx(l.Suspense,{fallback:null,children:e.jsx(It,{routeId:u,stopIds:y,stopIdx:C,route:m,companies:b,onMarkerClick:G})}),e.jsx(bt,{routeId:u,stopIdx:C,routeListEntry:p,stopIds:y,handleChange:P,onStopInfo:J}),e.jsx(Ct,{open:E,stops:$,onClose:K})]})},Rt=(t,s)=>{if(s[t]!==void 0)return t;const n=t.split("-")[0];return wt.findBestMatch(t.toUpperCase(),Object.keys(s).filter(o=>o.startsWith(n))).bestMatch.target},zt=(t,s)=>{for(let n=0;n<t.length;++n)if(t[n]in s)return s[t[n]];return[]},Bt=(t,s,n,o)=>{for(let r=0;r<t.length;++r)if(t[r]in s)return[[t[r],s[t[r]][o]]].concat(n[s[t[r]][o]]??[]);return[]};export{Nt as default};
